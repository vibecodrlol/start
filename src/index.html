<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Page with Settings Menu</title>
    <!-- Font Awesome for icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />
    <!-- Google Fonts: Nunito -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;900&display=swap"
      rel="stylesheet"
    />
    <!-- SortableJS for Drag and Drop -->
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
    <style>
      :root {
        /* 1. New Color Palette (Dark) - Tailwind Neutral */
        --dark-bg: #0a0a0a; /* neutral-950 */
        --dark-surface-rgb: 38, 38, 38; /* neutral-800 */
        --dark-surface-color: #262626; /* neutral-800 */
        --dark-primary-text: #fafafa; /* neutral-50 */
        --dark-secondary-text: #a3a3a3; /* neutral-400 */
        --dark-border-color: #404040; /* neutral-700 */
        --dark-toggle-off: #525252; /* neutral-600 */

        /* 1. New Color Palette (Light) - Tailwind Neutral */
        --light-bg: #fafafa; /* neutral-50 */
        --light-surface-rgb: 255, 255, 255; /* white */
        --light-surface-color: #ffffff; /* white */
        --light-primary-text: #171717; /* neutral-900 */
        --light-secondary-text: #737373; /* neutral-500 */
        --light-border-color: #e5e5e5; /* neutral-200 */
        --light-toggle-off: #d4d4d4; /* neutral-300 */

        /* Default to dark theme variables */
        --bg-color: var(--dark-bg);
        --surface-rgb: var(--dark-surface-rgb);
        --surface-color: var(--dark-surface-color);
        --primary-text-color: var(--dark-primary-text);
        --secondary-text-color: var(--dark-secondary-text);
        --border-color: var(--dark-border-color);
        --toggle-off-color: var(--dark-toggle-off);
      }

      body.light-theme {
        --bg-color: var(--light-bg);
        --surface-rgb: var(--light-surface-rgb);
        --surface-color: var(--light-surface-color);
        --primary-text-color: var(--light-primary-text);
        --secondary-text-color: var(--light-secondary-text);
        --border-color: var(--light-border-color);
        --toggle-off-color: var(--light-toggle-off);
      }

      body,
      html {
        margin: 0;
        padding: 0;
        height: 100%;
        width: 100%;
        background-color: var(--bg-color);
        overflow: hidden;
        font-family: "Nunito", sans-serif;
        transition: background-color 0.3s ease;
      }

      #background-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        z-index: -1;
        transition: opacity 0.5s ease, filter 0.3s ease;
      }

      /* --- Greeting & Clock Styles --- */
      .top-container {
        position: fixed;
        top: 25px;
        left: 25px;
        right: 25px;
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        z-index: 2;
        pointer-events: none;
        transition: filter 0.3s ease;
      }

      .greeting-container,
      .clock-container {
        color: white;
        text-shadow: 0px 0px 8px rgba(0, 0, 0, 0.7);
        flex-shrink: 1;
      }
      .greeting-container {
        text-align: left;
      }
      .clock-container {
        text-align: right;
      }

      #greeting-text {
        font-size: 1.75rem;
        font-weight: 700;
      }
      #greeting-name {
        font-size: 3.5rem;
        font-weight: 900;
        margin-top: 2px;
        display: -webkit-box;
        -webkit-box-orient: vertical;
        -webkit-line-clamp: 4;
        overflow: hidden;
        word-break: break-word;
      }
      .clock-time {
        font-size: 3.5rem;
        font-weight: 900;
      }
      .clock-date {
        font-size: 1.5rem;
        font-weight: 700;
      }

      .center-container {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        height: 100%;
        width: 100%;
        position: absolute;
        top: 0;
        left: 0;
        z-index: 1;
        gap: 20px;
        transition: filter 0.3s ease;
      }

      /* --- Search Bar Styles --- */
      .search-bar {
        position: relative;
        display: flex;
        align-items: center;
        width: 90%;
        max-width: 580px;
        background-color: rgba(var(--surface-rgb), 0.9);
        border-radius: 16px;
        color: var(--primary-text-color);
        border: 1px solid var(--border-color);
      }

      .search-engine-selector {
        position: relative;
      }

      #search-engine-button {
        background: none;
        border: none;
        cursor: pointer;
        padding: 0 16px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        height: 100%;
      }

      #current-engine-icon {
        width: 24px;
        height: 24px;
      }
      #search-engine-button i {
        color: var(--secondary-text-color);
        font-size: 0.8rem;
        transition: transform 0.3s ease;
      }
      .search-engine-selector.open #search-engine-button i {
        transform: rotate(180deg);
      }

      #search-engine-options {
        position: absolute;
        bottom: 100%;
        left: 0;
        margin-bottom: 10px;
        background-color: var(--bg-color);
        border: 1px solid var(--border-color);
        border-radius: 12px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        overflow: hidden;
        z-index: 10;
      }

      .engine-option {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 12px 16px;
        cursor: pointer;
        transition: background-color 0.2s;
      }
      .engine-option:hover {
        background-color: var(--surface-color);
      }
      .engine-option img {
        width: 20px;
        height: 20px;
      }

      .search-input {
        flex-grow: 1;
        padding: 16px 10px;
        border-radius: 0;
        background-color: transparent;
        color: var(--primary-text-color);
        font-size: 1rem;
        outline: none;
        border: none;
        font-family: "Nunito", sans-serif;
      }
      .search-input::placeholder {
        color: var(--secondary-text-color);
      }
      .search-icon {
        padding: 16px;
        color: var(--primary-text-color);
        font-size: 1.2rem;
        cursor: pointer;
        transition: transform 0.2s ease;
      }
      .search-icon:hover {
        transform: scale(1.1);
      }

      /* --- Quick Links Styles --- */
      .quicklinks-wrapper {
        width: 100%;
        display: flex;
        justify-content: center;
        position: relative;
        z-index: 1002;
      }
      .quicklinks-container {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 12px;
        flex-wrap: wrap;
        max-width: 800px;
      }

      .quicklinks-wrapper.position-bottom {
        position: fixed;
        bottom: 25px;
        left: 50%;
        transform: translateX(-50%);
      }

      .quicklink-item,
      #add-link-btn {
        display: flex;
        justify-content: center;
        align-items: center;
        width: 64px;
        height: 64px;
        background-color: rgba(var(--surface-rgb), 0.9);
        border: 1px solid var(--border-color);
        border-radius: 16px;
        text-decoration: none;
        transition: transform 0.2s ease, background-color 0.2s ease;
        cursor: pointer;
        position: relative;
      }

      body.edit-mode .quicklink-item {
        cursor: grab;
      }
      .quicklink-item:hover,
      #add-link-btn:hover {
        transform: translateY(-4px);
        background-color: var(--bg-color);
      }
      .quicklink-item img {
        width: 24px;
        height: 24px;
        object-fit: contain;
        pointer-events: none;
      }

      #add-link-btn {
        color: var(--primary-text-color);
        font-size: 1.5rem;
        cursor: pointer;
        border: none;
      }

      .sortable-ghost {
        opacity: 0.4;
      }

      /* --- Settings Button & Menu Styles --- */
      .icon-container {
        position: fixed;
        bottom: 25px;
        right: 25px;
        z-index: 1001;
        transition: filter 0.3s ease;
      }
      #settings-icon,
      #exit-edit-mode-icon {
        font-size: 24px;
        width: 24px;
        height: 24px;
        color: white;
        cursor: pointer;
        transition: transform 0.2s ease-in-out;
        text-shadow: 0px 0px 8px rgba(0, 0, 0, 0.7);
      }
      body.light-theme #exit-edit-mode-icon {
        color: var(--light-primary-text);
        text-shadow: none;
      }
      #settings-icon:hover {
        transform: scale(1.1) rotate(15deg);
      }
      #exit-edit-mode-icon:hover {
        transform: scale(1.1) rotate(15deg);
      }

      .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(5px);
        z-index: 998;
        opacity: 0;
        transition: opacity 0.3s ease;
        pointer-events: none;
      }
      .modal-menu {
        position: fixed;
        width: 90%;
        max-width: 350px;
        background-color: var(--bg-color);
        border: 1px solid var(--border-color);
        border-radius: 16px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        z-index: 999;
        color: var(--primary-text-color);
        opacity: 0;
        transition: opacity 0.3s ease, transform 0.3s ease;
        pointer-events: none;
        display: flex;
        flex-direction: column;
      }
      #settings-menu {
        transform-origin: bottom right;
        transform: scale(0.95);
      }
      #add-link-modal {
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%) scale(0.95);
      }
      .visible {
        opacity: 1;
        pointer-events: auto;
      }
      #settings-menu.visible {
        transform: scale(1);
      }
      #add-link-modal.visible {
        transform: translate(-50%, -50%) scale(1);
      }
      .hidden {
        display: none !important;
      }

      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 14px 20px;
        border-bottom: 1px solid var(--border-color);
        flex-shrink: 0;
      }
      .modal-header h2 {
        margin: 0;
        font-size: 1.1rem;
      }
      .close-modal-icon {
        font-size: 1.25rem;
        cursor: pointer;
        color: var(--secondary-text-color);
        transition: color 0.2s;
      }
      .close-modal-icon:hover {
        color: var(--primary-text-color);
      }
      .modal-body {
        padding: 14px;
        max-height: 70vh;
        overflow-y: auto;
      }
      .settings-option {
        background-color: var(--surface-color);
        border: 1px solid var(--border-color);
        border-radius: 10px;
        padding: 14px;
        margin-bottom: 10px;
      }
      .settings-option:last-child {
        margin-bottom: 0;
      }
      .option-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .option-title {
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .option-title i {
        width: 16px;
        text-align: center;
        font-size: 0.9rem;
        color: var(--secondary-text-color);
      }
      .option-header p {
        margin: 0;
        font-weight: 600;
        font-size: 0.95rem;
      }

      .toggle-switch {
        position: relative;
        display: inline-block;
        width: 44px;
        height: 24px;
        flex-shrink: 0;
      }
      .toggle-switch input {
        opacity: 0;
        width: 0;
        height: 0;
      }
      .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: var(--toggle-off-color);
        transition: 0.4s;
        border-radius: 34px;
      }
      .slider:before {
        position: absolute;
        content: "";
        height: 20px;
        width: 20px;
        left: 2px;
        bottom: 2px;
        background-color: white;
        transition: 0.4s;
        border-radius: 50%;
      }
      input:checked + .slider {
        background-color: var(--primary-text-color);
      }
      input:checked + .slider:before {
        transform: translateX(20px);
        background-color: var(--bg-color);
      }

      .option-details {
        margin-top: 14px;
      }
      .form-group {
        margin-bottom: 12px;
      }
      .form-group label {
        display: block;
        margin-bottom: 6px;
        font-size: 0.9rem;
        font-weight: 600;
        color: var(--secondary-text-color);
      }

      .modal-input,
      .modal-button {
        width: 100%;
        padding: 10px;
        background-color: var(--bg-color);
        border: 1px solid var(--border-color);
        border-radius: 8px;
        color: var(--primary-text-color);
        font-family: "Nunito", sans-serif;
        font-size: 0.9rem;
        font-weight: 600;
        box-sizing: border-box;
        transition: border-color 0.2s, background-color 0.2s;
      }
      .modal-input:focus {
        outline: none;
        border-color: var(--primary-text-color);
      }
      .modal-button {
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .modal-button i {
        margin-right: 8px;
      }
      .modal-button.primary {
        background-color: var(--primary-text-color);
        color: var(--bg-color);
        margin-top: 8px;
        border-color: var(--primary-text-color);
      }
      .modal-button.secondary {
        background-color: var(--surface-color);
        border-color: var(--border-color);
      }
      .modal-button.secondary:hover {
        background-color: var(--bg-color);
      }

      /* --- Theme/Position Selector --- */
      .segmented-control {
        display: flex;
        background-color: var(--bg-color);
        border-radius: 10px;
        padding: 4px;
        border: 1px solid var(--border-color);
      }
      .segmented-btn {
        flex: 1;
        background: none;
        border: none;
        color: var(--secondary-text-color);
        padding: 6px;
        border-radius: 8px;
        cursor: pointer;
        transition: background-color 0.2s, color 0.2s;
        font-size: 0.9rem;
        font-family: "Nunito", sans-serif;
      }
      .segmented-btn.active {
        background-color: var(--surface-color);
        color: var(--primary-text-color);
      }

      /* --- Custom Searchable Dropdown Styles --- */
      .searchable-dropdown {
        position: relative;
        margin-top: 12px;
      }
      .dropdown-selected {
        padding: 10px;
        background-color: var(--bg-color);
        border: 1px solid var(--border-color);
        border-radius: 8px;
        cursor: pointer;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .dropdown-selected i {
        color: var(--secondary-text-color);
        transition: transform 0.3s ease;
      }
      .searchable-dropdown.open .dropdown-selected i {
        transform: rotate(180deg);
      }
      .dropdown-options {
        position: absolute;
        bottom: 100%;
        left: 0;
        right: 0;
        background-color: var(--bg-color);
        border: 1px solid var(--border-color);
        border-radius: 8px;
        margin-bottom: 4px;
        max-height: 200px;
        overflow-y: auto;
        z-index: 10;
      }
      .dropdown-search {
        padding: 8px;
        border-bottom: 1px solid var(--border-color);
      }
      .dropdown-search input {
        width: 100%;
        background-color: var(--surface-color);
        border: 1px solid var(--border-color);
      }
      .dropdown-option {
        padding: 10px;
        cursor: pointer;
      }
      .dropdown-option:hover {
        background-color: var(--secondary-text-color);
      }

      /* Opacity Slider */
      .opacity-slider-container {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-top: 14px;
      }
      .opacity-slider-container i {
        color: var(--secondary-text-color);
      }
      input[type="range"] {
        -webkit-appearance: none;
        appearance: none;
        width: 100%;
        height: 6px;
        background: var(--border-color);
        border-radius: 5px;
        outline: none;
      }
      input[type="range"]::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 18px;
        height: 18px;
        background: var(--primary-text-color);
        border-radius: 50%;
        cursor: pointer;
      }

      /* Custom Color Picker */
      .color-picker-wrapper {
        display: flex;
        align-items: center;
        justify-content: space-between;
        background-color: var(--bg-color);
        border: 1px solid var(--border-color);
        border-radius: 8px;
        padding: 10px;
        cursor: pointer;
      }
      #color-preview {
        width: 20px;
        height: 20px;
        border-radius: 50%;
        border: 2px solid var(--surface-color);
      }
      #solid-color-picker {
        display: none;
      }

      /* --- Edit Mode Styles --- */
      body.edit-mode .top-container,
      body.edit-mode .search-bar {
        filter: blur(5px);
      }

      body.edit-mode .icon-container {
        z-index: 1003;
      }

      .link-actions {
        position: absolute;
        top: -8px;
        right: -8px;
        display: flex;
        gap: 4px;
      }

      .link-action-btn {
        background-color: var(--bg-color);
        border: 1px solid var(--border-color);
        color: var(--primary-text-color);
        width: 24px;
        height: 24px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.7rem;
        cursor: pointer;
      }

      #bg-file-input,
      #favicon-file-input {
        display: none;
      }
    </style>
  </head>
  <body>
    <div id="background-overlay"></div>

    <div class="top-container">
      <div id="greeting-container" class="greeting-container hidden">
        <div id="greeting-text"></div>
        <div id="greeting-name"></div>
      </div>
      <div id="clock-container" class="clock-container hidden">
        <div id="clock-time" class="clock-time"></div>
        <div id="clock-date" class="clock-date"></div>
      </div>
    </div>

    <div class="center-container">
      <div id="search-bar" class="search-bar">
        <div class="search-engine-selector">
          <button id="search-engine-button">
            <img id="current-engine-icon" src="" alt="Search Engine" />
            <i class="fa-solid fa-chevron-down"></i>
          </button>
          <div id="search-engine-options" class="hidden">
            <div class="engine-option" data-engine="google">
              <img
                src="https://icons.duckduckgo.com/ip3/google.com.ico"
                alt="Google"
              />
              <span>Google</span>
            </div>
            <div class="engine-option" data-engine="bing">
              <img
                src="https://icons.duckduckgo.com/ip3/bing.com.ico"
                alt="Bing"
              />
              <span>Bing</span>
            </div>
            <div class="engine-option" data-engine="duckduckgo">
              <img
                src="https://icons.duckduckgo.com/ip3/duckduckgo.com.ico"
                alt="DuckDuckGo"
              />
              <span>DuckDuckGo</span>
            </div>
          </div>
        </div>
        <input
          type="text"
          id="search-input"
          class="search-input"
          placeholder="Search the web"
        />
        <i
          id="search-icon"
          class="fa-solid fa-magnifying-glass search-icon"
        ></i>
      </div>
      <div id="quicklinks-wrapper" class="quicklinks-wrapper">
        <div id="quicklinks-container" class="quicklinks-container"></div>
      </div>
    </div>

    <input type="file" id="bg-file-input" accept="image/*" />
    <input
      type="file"
      id="favicon-file-input"
      accept=".png, .svg, .ico, image/png, image/svg+xml, image/x-icon"
    />

    <div class="icon-container">
      <i class="fa-solid fa-gear" id="settings-icon"></i>
      <i class="fa-solid fa-xmark hidden" id="exit-edit-mode-icon"></i>
    </div>

    <!-- Settings Menu -->
    <div class="modal-overlay" id="settings-overlay"></div>
    <div class="modal-menu" id="settings-menu">
      <div class="modal-header">
        <h2>Settings</h2>
        <i
          class="fa-solid fa-xmark close-modal-icon"
          id="close-settings-icon"
        ></i>
      </div>
      <div class="modal-body">
        <div class="settings-option">
          <div class="option-header" style="margin-bottom: 12px">
            <p class="option-title"><i class="fa-solid fa-palette"></i>Theme</p>
          </div>
          <div class="segmented-control">
            <button class="segmented-btn" data-theme="light">
              <i class="fa-regular fa-sun"></i>
            </button>
            <button class="segmented-btn" data-theme="dark">
              <i class="fa-regular fa-moon"></i>
            </button>
            <button class="segmented-btn" data-theme="system">
              <i class="fa-solid fa-desktop"></i>
            </button>
          </div>
        </div>
        <div class="settings-option">
          <div class="option-header">
            <p class="option-title">
              <i class="fa-regular fa-hand-spock"></i>Greeting
            </p>
            <label class="toggle-switch">
              <input type="checkbox" id="greeting-toggle" />
              <span class="slider"></span>
            </label>
          </div>
          <div id="greeting-details" class="option-details hidden">
            <input
              type="text"
              id="greeting-name-input"
              class="modal-input"
              placeholder="Enter your name"
              maxlength="100"
            />
          </div>
        </div>
        <div class="settings-option">
          <div class="option-header">
            <p class="option-title"><i class="fa-regular fa-clock"></i>Clock</p>
            <label class="toggle-switch">
              <input type="checkbox" id="clock-toggle" />
              <span class="slider"></span>
            </label>
          </div>
          <div id="clock-details" class="option-details hidden">
            <div class="option-header" style="margin-bottom: 12px">
              <p>24-Hour Format</p>
              <label class="toggle-switch">
                <input type="checkbox" id="clock-format-toggle" />
                <span class="slider"></span>
              </label>
            </div>
            <div id="timezone-dropdown" class="searchable-dropdown">
              <div id="timezone-selected" class="dropdown-selected">
                <span>Select Timezone</span>
                <i class="fa-solid fa-chevron-down"></i>
              </div>
              <div id="timezone-options" class="dropdown-options hidden">
                <div class="dropdown-search">
                  <input
                    type="text"
                    id="timezone-search"
                    class="modal-input"
                    placeholder="Search..."
                  />
                </div>
                <div id="timezone-list"></div>
              </div>
            </div>
          </div>
        </div>
        <div class="settings-option">
          <div class="option-header">
            <p class="option-title">
              <i class="fa-solid fa-magnifying-glass"></i>Search Bar
            </p>
            <label class="toggle-switch">
              <input type="checkbox" id="searchbar-toggle" />
              <span class="slider"></span>
            </label>
          </div>
        </div>
        <div class="settings-option">
          <div class="option-header">
            <p class="option-title">
              <i class="fa-solid fa-link"></i>Quick Links
            </p>
            <label class="toggle-switch">
              <input type="checkbox" id="quicklinks-toggle" />
              <span class="slider"></span>
            </label>
          </div>
          <div id="quicklinks-details" class="option-details hidden">
            <div class="segmented-control" style="margin-bottom: 10px">
              <button class="segmented-btn" data-position="center">
                Center
              </button>
              <button class="segmented-btn" data-position="bottom">
                Bottom
              </button>
            </div>
            <button id="edit-links-btn" class="modal-button secondary">
              Edit Links
            </button>
          </div>
        </div>
        <div class="settings-option">
          <div class="option-header" style="margin-bottom: 12px">
            <p class="option-title">
              <i class="fa-solid fa-image"></i>Background
            </p>
          </div>
          <div class="segmented-control">
            <button class="segmented-btn" data-bg-mode="solid">Solid</button>
            <button class="segmented-btn" data-bg-mode="random">Random</button>
            <button class="segmented-btn" data-bg-mode="custom">Custom</button>
          </div>
          <div id="background-details" class="option-details">
            <div id="solid-color-wrapper" class="color-picker-wrapper hidden">
              <span>Select Color</span>
              <div id="color-preview"></div>
            </div>
            <input type="color" id="solid-color-picker" />
            <button id="custom-bg-button" class="modal-button secondary hidden">
              <i class="fa-solid fa-upload"></i>
              Set Background
            </button>
            <div
              class="opacity-slider-container hidden"
              id="opacity-control-container"
            >
              <i class="fa-regular fa-circle"></i>
              <input
                type="range"
                id="background-opacity-slider"
                min="0"
                max="1"
                step="0.05"
              />
              <i class="fa-solid fa-circle"></i>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Add/Edit Link Modal -->
    <div class="modal-overlay" id="add-link-overlay"></div>
    <div class="modal-menu" id="add-link-modal">
      <div class="modal-header">
        <h2 id="link-modal-title">Add Quick Link</h2>
        <i
          class="fa-solid fa-xmark close-modal-icon"
          id="close-add-link-icon"
        ></i>
      </div>
      <div class="modal-body">
        <form id="add-link-form">
          <input type="hidden" id="link-edit-index" />
          <div class="form-group">
            <label for="link-url">URL</label>
            <input type="url" id="link-url" class="modal-input" required />
          </div>
          <div class="settings-option" style="padding: 12px">
            <div class="option-header">
              <p>Custom Favicon</p>
              <label class="toggle-switch">
                <input type="checkbox" id="favicon-toggle" />
                <span class="slider"></span>
              </label>
            </div>
            <div id="favicon-details" class="option-details hidden">
              <button
                type="button"
                id="link-favicon-btn"
                class="modal-button secondary"
              >
                <i class="fa-solid fa-upload"></i>
                Upload Image
              </button>
            </div>
          </div>
          <button
            type="submit"
            id="link-submit-btn"
            class="modal-button primary"
          >
            Add Link
          </button>
        </form>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        // --- DOM Elements ---
        const body = document.body;
        const backgroundOverlay = document.getElementById("background-overlay");
        const greetingContainer = document.getElementById("greeting-container");
        const greetingText = document.getElementById("greeting-text");
        const greetingName = document.getElementById("greeting-name");
        const clockContainer = document.getElementById("clock-container");
        const clockTime = document.getElementById("clock-time");
        const clockDate = document.getElementById("clock-date");

        const quicklinksWrapper = document.getElementById("quicklinks-wrapper");
        const quicklinksContainer = document.getElementById(
          "quicklinks-container"
        );

        const searchBar = document.getElementById("search-bar");
        const searchInput = document.getElementById("search-input");
        const searchIcon = document.getElementById("search-icon");
        const searchEngineSelector = document.querySelector(
          ".search-engine-selector"
        );
        const searchEngineButton = document.getElementById(
          "search-engine-button"
        );
        const currentEngineIcon = document.getElementById(
          "current-engine-icon"
        );
        const searchEngineOptions = document.getElementById(
          "search-engine-options"
        );

        const settingsIcon = document.getElementById("settings-icon");
        const exitEditModeIcon = document.getElementById("exit-edit-mode-icon");
        const settingsOverlay = document.getElementById("settings-overlay");
        const settingsMenu = document.getElementById("settings-menu");
        const closeSettingsIcon = document.getElementById(
          "close-settings-icon"
        );

        const addLinkOverlay = document.getElementById("add-link-overlay");
        const addLinkModal = document.getElementById("add-link-modal");
        const closeAddLinkIcon = document.getElementById("close-add-link-icon");
        const addLinkForm = document.getElementById("add-link-form");
        const linkModalTitle = document.getElementById("link-modal-title");
        const linkEditIndex = document.getElementById("link-edit-index");
        const linkUrlInput = document.getElementById("link-url");
        const linkSubmitBtn = document.getElementById("link-submit-btn");
        const faviconToggle = document.getElementById("favicon-toggle");
        const faviconDetails = document.getElementById("favicon-details");
        const linkFaviconBtn = document.getElementById("link-favicon-btn");

        const bgFileInput = document.getElementById("bg-file-input");
        const faviconFileInput = document.getElementById("favicon-file-input");

        // Toggles and inputs
        const themeButtons = document.querySelectorAll(
          ".segmented-btn[data-theme]"
        );
        const greetingToggle = document.getElementById("greeting-toggle");
        const greetingDetails = document.getElementById("greeting-details");
        const greetingNameInput = document.getElementById(
          "greeting-name-input"
        );

        const clockToggle = document.getElementById("clock-toggle");
        const clockDetails = document.getElementById("clock-details");
        const clockFormatToggle = document.getElementById(
          "clock-format-toggle"
        );

        const timezoneDropdown = document.getElementById("timezone-dropdown");
        const timezoneSelected = document
          .getElementById("timezone-selected")
          .querySelector("span");
        const timezoneOptions = document.getElementById("timezone-options");
        const timezoneSearch = document.getElementById("timezone-search");
        const timezoneList = document.getElementById("timezone-list");

        const searchbarToggle = document.getElementById("searchbar-toggle");
        const quicklinksToggle = document.getElementById("quicklinks-toggle");
        const quicklinksDetails = document.getElementById("quicklinks-details");
        const quicklinksPositionButtons = document.querySelectorAll(
          "#quicklinks-details .segmented-btn"
        );
        const editLinksBtn = document.getElementById("edit-links-btn");

        const backgroundModeButtons = document.querySelectorAll(
          ".segmented-btn[data-bg-mode]"
        );
        const solidColorWrapper = document.getElementById(
          "solid-color-wrapper"
        );
        const solidColorPicker = document.getElementById("solid-color-picker");
        const colorPreview = document.getElementById("color-preview");
        const customBgButton = document.getElementById("custom-bg-button");
        const opacityControlContainer = document.getElementById(
          "opacity-control-container"
        );
        const backgroundOpacitySlider = document.getElementById(
          "background-opacity-slider"
        );

        let clockInterval;
        let customFaviconData = null;
        let ALL_TIMEZONES = [];
        let sortable;

        const mediaQuery = window.matchMedia("(prefers-color-scheme: dark)");

        // --- Functions ---
        const openModal = (overlay, menu) => {
          if (menu.id === "settings-menu") {
            const iconRect = settingsIcon.getBoundingClientRect();
            menu.style.right = `${window.innerWidth - iconRect.right}px`;
            menu.style.bottom = `${window.innerHeight - iconRect.top + 32}px`;
          }
          overlay.classList.add("visible");
          menu.classList.add("visible");
        };

        const closeModal = (overlay, menu) => {
          overlay.classList.remove("visible");
          menu.classList.remove("visible");
        };

        const renderQuickLinks = (editMode = false) => {
          const links = JSON.parse(localStorage.getItem("quicklinks")) || [];
          quicklinksContainer.innerHTML = "";

          links.forEach((link, index) => {
            const linkEl = document.createElement("a");
            linkEl.href = editMode ? "#" : link.url;
            linkEl.className = "quicklink-item";
            if (!editMode) {
              linkEl.rel = "noopener noreferrer";
            }
            linkEl.dataset.id = index;

            const faviconEl = document.createElement("img");
            faviconEl.src = link.favicon;
            faviconEl.onerror = () => {
              faviconEl.src = `data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512' fill='%23${
                body.classList.contains("light-theme") ? "171717" : "fafafa"
              }'%3E%3Cpath d='M352 256c0 22.2-1.2 43.6-3.3 64H163.3c-2.2-20.4-3.3-41.8-3.3-64s1.2-43.6 3.3-64H348.7c2.2 20.4 3.3 41.8 3.3 64zm28.8-96H131.2c-25.6 4.5-49.1 16.7-68.6 36.2-14.2 14.2-24.4 31.3-30.8 49.8C25.2 264.4 24 286.8 24 310c0 22.8 1.2 45.2 3.5 66.8 6.3 18.5 16.5 35.6 30.8 49.8 19.5 19.5 43 31.7 68.6 36.2H380.8c25.6-4.5 49.1-16.7 68.6-36.2 14.2-14.2 24.4-31.3 30.8-49.8 2.3-21.6 3.5-44 3.5-66.8s-1.2-45.2-3.5-66.8c-6.3-18.5-16.5-35.6-30.8-49.8-19.5-19.5-43-31.7-68.6-36.2zM256 512c141.4 0 256-114.6 256-256S397.4 0 256 0 0 114.6 0 256s114.6 256 256 256z'/%3E%3C/svg%3E`;
            };

            linkEl.appendChild(faviconEl);

            if (editMode) {
              const actions = document.createElement("div");
              actions.className = "link-actions";

              const editBtn = document.createElement("button");
              editBtn.className = "link-action-btn";
              editBtn.innerHTML = '<i class="fa-solid fa-pencil"></i>';
              editBtn.onclick = (e) => {
                e.preventDefault();
                openEditModal(index);
              };

              const deleteBtn = document.createElement("button");
              deleteBtn.className = "link-action-btn";
              deleteBtn.innerHTML = '<i class="fa-solid fa-xmark"></i>';
              deleteBtn.onclick = (e) => {
                e.preventDefault();
                links.splice(index, 1);
                localStorage.setItem("quicklinks", JSON.stringify(links));
                renderQuickLinks(true);
              };

              actions.appendChild(editBtn);
              actions.appendChild(deleteBtn);
              linkEl.appendChild(actions);
            }

            quicklinksContainer.appendChild(linkEl);
          });

          if (quicklinksToggle.checked && editMode && links.length < 10) {
            const addBtn = document.createElement("button");
            addBtn.id = "add-link-btn";
            addBtn.innerHTML = '<i class="fa-solid fa-plus"></i>';
            addBtn.onclick = () => openEditModal();
            quicklinksContainer.appendChild(addBtn);
          }
        };

        const updateGreeting = () => {
          if (!greetingToggle.checked) return;
          const now = new Date();
          const hour = now.getHours();
          const name = localStorage.getItem("greetingName") || "Anon";
          let timeOfDay;

          if (hour < 12) timeOfDay = "Good morning";
          else if (hour < 18) timeOfDay = "Good afternoon";
          else timeOfDay = "Good evening";

          greetingText.textContent = `${timeOfDay},`;
          greetingName.textContent = `${name}.`;
        };

        const updateClock = () => {
          if (!clockToggle.checked) return;
          const now = new Date();
          const timeZone = localStorage.getItem("clockTimezone");
          const hour12 = !(localStorage.getItem("clockFormat24h") === "true");

          const timeOptions = {
            hour: "numeric",
            minute: "numeric",
            hour12: hour12,
            timeZone: timeZone,
          };
          const dateOptions = {
            weekday: "short",
            month: "short",
            day: "numeric",
            timeZone: timeZone,
          };

          clockTime.textContent = new Intl.DateTimeFormat(
            "en-US",
            timeOptions
          ).format(now);
          clockDate.textContent = new Intl.DateTimeFormat(
            "en-US",
            dateOptions
          ).format(now);
        };

        const populateTimezoneList = (filter = "") => {
          timezoneList.innerHTML = "";
          const filteredTimezones = ALL_TIMEZONES.filter((tz) =>
            tz.toLowerCase().includes(filter.toLowerCase())
          );

          filteredTimezones.forEach((tz) => {
            const option = document.createElement("div");
            option.className = "dropdown-option";
            option.textContent = tz;
            option.dataset.value = tz;
            option.onclick = () => {
              timezoneSelected.textContent = tz;
              localStorage.setItem("clockTimezone", tz);
              updateClock();
              timezoneOptions.classList.add("hidden");
              timezoneDropdown.classList.remove("open");
            };
            timezoneList.appendChild(option);
          });
        };

        const performSearch = () => {
          const query = searchInput.value;
          if (!query.trim()) return;

          const engine = localStorage.getItem("searchEngine") || "google";
          let searchUrl;

          switch (engine) {
            case "bing":
              searchUrl = `https://www.bing.com/search?q=${encodeURIComponent(
                query
              )}`;
              break;
            case "duckduckgo":
              searchUrl = `https://duckduckgo.com/?q=${encodeURIComponent(
                query
              )}`;
              break;
            default:
              searchUrl = `https://www.google.com/search?q=${encodeURIComponent(
                query
              )}`;
              break;
          }

          window.location.href = searchUrl;
        };

        const updateSearchEngineIcon = (engine) => {
          currentEngineIcon.src = `https://icons.duckduckgo.com/ip3/${engine}.com.ico`;
        };

        const applyTheme = (theme) => {
          if (theme === "system") {
            body.classList.toggle("light-theme", !mediaQuery.matches);
          } else {
            body.classList.toggle("light-theme", theme === "light");
          }

          themeButtons.forEach((btn) =>
            btn.classList.toggle("active", btn.dataset.theme === theme)
          );

          if (localStorage.getItem("bgMode") === "solid") {
            const newDefaultColor = body.classList.contains("light-theme")
              ? "#fafafa"
              : "#0a0a0a";
            body.style.backgroundColor = newDefaultColor;
            solidColorPicker.value = newDefaultColor;
            colorPreview.style.backgroundColor = newDefaultColor;
            localStorage.setItem("solidBgColor", newDefaultColor);
          }
        };

        const applyQuicklinksPosition = (position) => {
          quicklinksWrapper.classList.remove("position-bottom");
          if (position === "bottom") {
            quicklinksWrapper.classList.add("position-bottom");
          }
          quicklinksPositionButtons.forEach((btn) =>
            btn.classList.toggle("active", btn.dataset.position === position)
          );
        };

        const applyBackground = (mode) => {
          solidColorWrapper.classList.add("hidden");
          customBgButton.classList.add("hidden");
          opacityControlContainer.classList.add("hidden");

          backgroundModeButtons.forEach((btn) =>
            btn.classList.toggle("active", btn.dataset.bgMode === mode)
          );

          if (mode === "solid") {
            solidColorWrapper.classList.remove("hidden");
            const color =
              localStorage.getItem("solidBgColor") ||
              (body.classList.contains("light-theme") ? "#fafafa" : "#0a0a0a");
            body.style.backgroundColor = color;
            colorPreview.style.backgroundColor = color;
            solidColorPicker.value = color;
            backgroundOverlay.style.backgroundImage = "none";
          } else {
            body.style.backgroundColor = "transparent";
            opacityControlContainer.classList.remove("hidden");
            if (mode === "random") {
              if (localStorage.getItem("randomBgUrl")) {
                backgroundOverlay.style.backgroundImage = `url('${localStorage.getItem(
                  "randomBgUrl"
                )}')`;
              } else {
                const randomUrl = `https://picsum.photos/1920/1080?random=${new Date().getTime()}`;
                localStorage.setItem("randomBgUrl", randomUrl);
                backgroundOverlay.style.backgroundImage = `url('${randomUrl}')`;
              }
            } else if (mode === "custom") {
              customBgButton.classList.remove("hidden");
              const savedBg = localStorage.getItem("customBgUrl");
              if (savedBg) {
                backgroundOverlay.style.backgroundImage = `url('${savedBg}')`;
              } else {
                backgroundOverlay.style.backgroundImage = "none";
              }
            }
          }

          localStorage.setItem("bgMode", mode);
        };

        const openEditModal = (index = null) => {
          addLinkForm.reset();
          linkEditIndex.value = index;
          customFaviconData = null;
          faviconToggle.checked = false;
          faviconDetails.classList.add("hidden");
          linkFaviconBtn.innerHTML =
            '<i class="fa-solid fa-upload"></i> Upload Image';

          if (index !== null) {
            const links = JSON.parse(localStorage.getItem("quicklinks")) || [];
            const link = links[index];
            linkModalTitle.textContent = "Edit Quick Link";
            linkUrlInput.value = link.url;
            linkSubmitBtn.textContent = "Save Changes";
          } else {
            linkModalTitle.textContent = "Add Quick Link";
            linkSubmitBtn.textContent = "Add Link";
          }

          openModal(addLinkOverlay, addLinkModal);
        };

        // --- Event Listeners ---
        settingsIcon.addEventListener("click", () =>
          openModal(settingsOverlay, settingsMenu)
        );
        closeSettingsIcon.addEventListener("click", () =>
          closeModal(settingsOverlay, settingsMenu)
        );
        settingsOverlay.addEventListener("click", () => {
          closeModal(settingsOverlay, settingsMenu);
          timezoneOptions.classList.add("hidden");
          timezoneDropdown.classList.remove("open");
          searchEngineOptions.classList.add("hidden");
          searchEngineSelector.classList.remove("open");
        });

        closeAddLinkIcon.addEventListener("click", () =>
          closeModal(addLinkOverlay, addLinkModal)
        );
        addLinkOverlay.addEventListener("click", () =>
          closeModal(addLinkOverlay, addLinkModal)
        );

        searchEngineButton.addEventListener("click", (e) => {
          e.stopPropagation();
          searchEngineOptions.classList.toggle("hidden");
          searchEngineSelector.classList.toggle("open");
        });

        document.querySelectorAll(".engine-option").forEach((option) => {
          option.addEventListener("click", () => {
            const engine = option.dataset.engine;
            localStorage.setItem("searchEngine", engine);
            updateSearchEngineIcon(engine);
            searchEngineOptions.classList.add("hidden");
            searchEngineSelector.classList.remove("open");
          });
        });

        searchInput.addEventListener("keydown", (e) => {
          if (e.key === "Enter") performSearch();
        });
        searchIcon.addEventListener("click", performSearch);

        themeButtons.forEach((button) => {
          button.addEventListener("click", () => {
            const theme = button.dataset.theme;
            localStorage.setItem("theme", theme);
            applyTheme(theme);
          });
        });

        mediaQuery.addEventListener("change", () => {
          if (localStorage.getItem("theme") === "system") applyTheme("system");
        });

        greetingToggle.addEventListener("change", () => {
          localStorage.setItem("greetingEnabled", greetingToggle.checked);
          greetingContainer.classList.toggle("hidden", !greetingToggle.checked);
          greetingDetails.classList.toggle("hidden", !greetingToggle.checked);
          if (greetingToggle.checked) updateGreeting();
        });

        greetingNameInput.addEventListener("input", () => {
          localStorage.setItem("greetingName", greetingNameInput.value);
          updateGreeting();
        });

        clockToggle.addEventListener("change", () => {
          localStorage.setItem("clockEnabled", clockToggle.checked);
          clockContainer.classList.toggle("hidden", !clockToggle.checked);
          clockDetails.classList.toggle("hidden", !clockToggle.checked);
          if (clockToggle.checked) {
            updateClock();
            clockInterval = setInterval(updateClock, 1000);
          } else {
            clearInterval(clockInterval);
          }
        });

        clockFormatToggle.addEventListener("change", () => {
          localStorage.setItem("clockFormat24h", clockFormatToggle.checked);
          updateClock();
        });

        document
          .getElementById("timezone-selected")
          .addEventListener("click", (e) => {
            e.stopPropagation();
            timezoneOptions.classList.toggle("hidden");
            timezoneDropdown.classList.toggle("open");
            timezoneSearch.value = "";
            populateTimezoneList();
            timezoneSearch.focus();
          });

        timezoneSearch.addEventListener("input", () => {
          populateTimezoneList(timezoneSearch.value);
        });

        searchbarToggle.addEventListener("change", () => {
          localStorage.setItem("searchbarEnabled", searchbarToggle.checked);
          searchBar.classList.toggle("hidden", !searchbarToggle.checked);
        });

        quicklinksToggle.addEventListener("change", () => {
          localStorage.setItem("quicklinksEnabled", quicklinksToggle.checked);
          quicklinksWrapper.classList.toggle(
            "hidden",
            !quicklinksToggle.checked
          );
          quicklinksDetails.classList.toggle(
            "hidden",
            !quicklinksToggle.checked
          );
          if (quicklinksToggle.checked) {
            renderQuickLinks();
          }
        });

        quicklinksPositionButtons.forEach((button) => {
          button.addEventListener("click", () => {
            const position = button.dataset.position;
            localStorage.setItem("quicklinksPosition", position);
            applyQuicklinksPosition(position);
          });
        });

        editLinksBtn.addEventListener("click", () => {
          body.classList.add("edit-mode");
          settingsIcon.classList.add("hidden");
          exitEditModeIcon.classList.remove("hidden");
          sortable.option("disabled", false);
          renderQuickLinks(true);
          closeModal(settingsOverlay, settingsMenu);
        });

        exitEditModeIcon.addEventListener("click", () => {
          body.classList.remove("edit-mode");
          settingsIcon.classList.remove("hidden");
          exitEditModeIcon.classList.add("hidden");
          sortable.option("disabled", true);
          renderQuickLinks(false);
        });

        backgroundModeButtons.forEach((button) => {
          button.addEventListener("click", () => {
            applyBackground(button.dataset.bgMode);
          });
        });

        solidColorWrapper.addEventListener("click", () => {
          solidColorPicker.click();
        });

        solidColorPicker.addEventListener("input", (e) => {
          const color = e.target.value;
          localStorage.setItem("solidBgColor", color);
          colorPreview.style.backgroundColor = color;
          if (localStorage.getItem("bgMode") === "solid") {
            body.style.backgroundColor = color;
          }
        });

        customBgButton.addEventListener("click", () => bgFileInput.click());

        bgFileInput.addEventListener("change", (event) => {
          const file = event.target.files[0];
          if (file) {
            const reader = new FileReader();
            reader.onload = (e) => {
              const imageUrl = e.target.result;
              localStorage.setItem("customBgUrl", imageUrl);
              if (localStorage.getItem("bgMode") === "custom") {
                backgroundOverlay.style.backgroundImage = `url('${imageUrl}')`;
              }
            };
            reader.readAsDataURL(file);
          }
        });

        backgroundOpacitySlider.addEventListener("input", (e) => {
          const opacity = e.target.value;
          backgroundOverlay.style.opacity = opacity;
          localStorage.setItem("backgroundOpacity", opacity);
        });

        faviconToggle.addEventListener("change", () => {
          faviconDetails.classList.toggle("hidden", !faviconToggle.checked);
        });

        linkFaviconBtn.addEventListener("click", () =>
          faviconFileInput.click()
        );

        faviconFileInput.addEventListener("change", (event) => {
          const file = event.target.files[0];
          if (file) {
            const reader = new FileReader();
            reader.onload = (e) => {
              customFaviconData = e.target.result;
              linkFaviconBtn.innerHTML =
                '<i class="fa-solid fa-check"></i> Image Selected!';
            };
            reader.readAsDataURL(file);
          }
        });

        addLinkForm.addEventListener("submit", (e) => {
          e.preventDefault();
          const links = JSON.parse(localStorage.getItem("quicklinks")) || [];
          const editIdx = linkEditIndex.value;

          if (editIdx === "" && links.length >= 10) return;

          let url = linkUrlInput.value;
          if (!url) return;

          if (!/^https?:\/\//i.test(url)) url = "https://" + url;

          let hostname;
          try {
            hostname = new URL(url).hostname.replace("www.", "");
          } catch {
            hostname = url;
          }

          const favicon =
            faviconToggle.checked && customFaviconData
              ? customFaviconData
              : `https://icons.duckduckgo.com/ip3/${hostname}.ico`;

          const newLink = { url, favicon };

          if (editIdx !== "") {
            links[editIdx] = newLink;
          } else {
            links.push(newLink);
          }

          localStorage.setItem("quicklinks", JSON.stringify(links));

          renderQuickLinks(true);
          closeModal(addLinkOverlay, addLinkModal);
        });

        // --- Initialization on Page Load ---
        const init = () => {
          // Theme Init
          const savedTheme = localStorage.getItem("theme") || "system";
          applyTheme(savedTheme);

          // Search Engine Init
          const savedEngine = localStorage.getItem("searchEngine") || "google";
          updateSearchEngineIcon(savedEngine);

          // Background Init
          const savedOpacity = localStorage.getItem("backgroundOpacity") || 1;
          backgroundOverlay.style.opacity = savedOpacity;
          backgroundOpacitySlider.value = savedOpacity;

          const savedBgColor =
            localStorage.getItem("solidBgColor") ||
            (body.classList.contains("light-theme") ? "#fafafa" : "#0a0a0a");
          solidColorPicker.value = savedBgColor;
          colorPreview.style.backgroundColor = savedBgColor;

          const savedMode = localStorage.getItem("bgMode") || "solid";
          applyBackground(savedMode);

          // Greeting Init
          if (localStorage.getItem("greetingEnabled") === "true") {
            greetingToggle.checked = true;
            greetingContainer.classList.remove("hidden");
            greetingDetails.classList.remove("hidden");
            greetingNameInput.value =
              localStorage.getItem("greetingName") || "";
            updateGreeting();
          }
          setInterval(updateGreeting, 60000);

          // Clock Init
          ALL_TIMEZONES = Intl.supportedValuesOf("timeZone");
          const savedTimezone =
            localStorage.getItem("clockTimezone") ||
            Intl.DateTimeFormat().resolvedOptions().timeZone;
          timezoneSelected.textContent = savedTimezone;
          localStorage.setItem("clockTimezone", savedTimezone);

          if (localStorage.getItem("clockFormat24h") === null)
            localStorage.setItem("clockFormat24h", "true");
          clockFormatToggle.checked =
            localStorage.getItem("clockFormat24h") === "true";

          if (localStorage.getItem("clockEnabled") === "true") {
            clockToggle.checked = true;
            clockContainer.classList.remove("hidden");
            clockDetails.classList.remove("hidden");
            updateClock();
            clockInterval = setInterval(updateClock, 1000);
          }

          // Search Bar Init
          if (localStorage.getItem("searchbarEnabled") === null)
            localStorage.setItem("searchbarEnabled", "true");
          const searchbarEnabled =
            localStorage.getItem("searchbarEnabled") === "true";
          searchbarToggle.checked = searchbarEnabled;
          searchBar.classList.toggle("hidden", !searchbarEnabled);

          // Quicklinks Init
          const quicklinksEnabled =
            localStorage.getItem("quicklinksEnabled") === "true";
          quicklinksToggle.checked = quicklinksEnabled;
          quicklinksWrapper.classList.toggle("hidden", !quicklinksEnabled);
          quicklinksDetails.classList.toggle("hidden", !quicklinksEnabled);

          const savedPosition =
            localStorage.getItem("quicklinksPosition") || "center";
          applyQuicklinksPosition(savedPosition);

          if (quicklinksEnabled) renderQuickLinks();

          // Init Sortable
          sortable = new Sortable(quicklinksContainer, {
            animation: 150,
            ghostClass: "sortable-ghost",
            filter: "#add-link-btn",
            preventOnFilter: true,
            disabled: true, // Disabled by default
            onEnd: (evt) => {
              const links =
                JSON.parse(localStorage.getItem("quicklinks")) || [];
              const [reorderedItem] = links.splice(evt.oldIndex, 1);
              links.splice(evt.newIndex, 0, reorderedItem);
              localStorage.setItem("quicklinks", JSON.stringify(links));
            },
          });
        };

        init();
      });
    </script>
  </body>
</html>
